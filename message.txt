-- Haiiz Kaitun Ultimate | Blox Fruits Complete Auto System
-- Version: 6.0 | All Features Included | Rebuilt from Scratch
-- For Educational Purposes Only

-- =============================================
-- üì¶ SERVICES & LIBRARIES
-- =============================================
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local VirtualInputManager = game:GetService("VirtualInputManager")
local TeleportService = game:GetService("TeleportService")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local HttpService = game:GetService("HttpService")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")

-- Player
local Player = Players.LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
local Humanoid = Character:WaitForChild("Humanoid")

-- Anti AFK
local VirtualUser = game:GetService("VirtualUser")
Player.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)

-- Load UI Library
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("üî• HAIIZ KAITUN ULTIMATE v6.0", "BloodTheme")

-- =============================================
-- ‚öôÔ∏è CONFIGURATION SYSTEM
-- =============================================
local Config = {
    AutoFarm = {
        Enabled = false,
        LevelRange = {Min = 1, Max = 2800},
        Distance = 50,
        AttackDelay = 0.1,
        TeleportDelay = 0.3
    },
    
    AutoMelee = {
        Enabled = false,
        PurchaseOrder = {
            "Dark Step", "Electric", "Water Kung Fu", "Dragon Breath",
            "Superhuman", "Death Step", "Sharkman Karate", "Dragon Talon",
            "Electric Claw", "Godhuman", "Sanguine Art"
        }
    },
    
    AutoStats = {
        Enabled = true,
        Priority = {"Melee", "Health", "Sword", "Defense", "Fruit", "Gun"}
    },
    
    AutoQuest = {
        SoulGuitar = false,
        CDK = false,
        BuddySword = false,
        HallowScythe = false,
        DarkDagger = false
    },
    
    AutoBoss = {
        Enabled = false,
        FarmMode = "Fast", -- Fast, Safe, Mixed
        SkipLowHP = true,
        MinHealth = 1000
    },
    
    AutoRaid = {
        Enabled = false,
        TargetFragments = 10000,
        SelectedFruits = {"Rocket", "Spin", "Blade", "Spring", "Flame", "Ice", "Dark", "Light", "Magma"}
    },
    
    AutoFruit = {
        RandomFruit = false,
        StoreHop = false,
        BuyAllFruits = false,
        SellFruit = false
    },
    
    AutoMaterial = {
        Bones = false,
        Ectoplasm = false,
        FishTail = false,
        MagmaOre = false,
        MysticDroplet = false,
        DragonScale = false
    },
    
    Misc = {
        AutoRedeem = false,
        ServerHop = false,
        AntiStuck = true,
        SafeTeleport = true,
        Notifications = true
    }
}

-- =============================================
-- üß† CORE FUNCTIONS
-- =============================================
local PlayerData = {
    Level = 0,
    Beli = 0,
    Fragments = 0,
    Points = 0,
    LastUpdate = 0
}

function UpdatePlayerData()
    if tick() - PlayerData.LastUpdate > 3 then
        pcall(function()
            PlayerData.Level = Player.Data.Level.Value
            PlayerData.Beli = Player.Data.Beli.Value
            PlayerData.Fragments = Player.Data.Fragments.Value
            PlayerData.Points = Player.Data.Points.Value
            PlayerData.LastUpdate = tick()
        end)
    end
end

function GetPlayerLevel() return PlayerData.Level end
function GetBeli() return PlayerData.Beli end
function GetFragments() return PlayerData.Fragments end
function GetPoints() return PlayerData.Points end

function CheckSea()
    local PlaceID = game.PlaceId
    local Seas = {
        [2753915549] = 1,  -- First Sea
        [4442272183] = 2,  -- Second Sea
        [7449423635] = 3   -- Third Sea
    }
    return Seas[PlaceID] or 0
end

function SafeTeleport(CFramePos, HeightOffset)
    if not Character or Character.Humanoid.Health <= 0 then
        Character = Player.Character or Player.CharacterAdded:Wait()
        HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
    end
    
    pcall(function()
        local HRP = Character.HumanoidRootPart
        
        if Config.Misc.SafeTeleport then
            -- Teleport with safety checks
            local startPos = HRP.Position
            HRP.CFrame = CFramePos + Vector3.new(0, HeightOffset or 5, 0)
            
            -- Verify teleport
            task.wait(0.1)
            if (HRP.Position - (CFramePos.Position + Vector3.new(0, HeightOffset or 5, 0))).Magnitude > 10 then
                HRP.CFrame = CFrame.new(startPos)
            end
        else
            HRP.CFrame = CFramePos
        end
    end)
end

function EquipBestTool()
    -- Prioritize: Melee > Sword > Gun > Fruit
    local backpack = Player.Backpack:GetChildren()
    local characterTools = {}
    
    -- Check current equipped tools
    for _, tool in pairs(Character:GetChildren()) do
        if tool:IsA("Tool") then
            table.insert(characterTools, tool.Name)
        end
    end
    
    -- Equip by priority
    local priorities = {"Melee", "Sword", "Gun", "Blox Fruit"}
    
    for _, type in pairs(priorities) do
        for _, tool in pairs(backpack) do
            if tool:IsA("Tool") then
                local toolName = tool.Name:lower()
                
                if type == "Melee" and (
                    toolName:find("step") or 
                    toolName:find("karate") or 
                    toolName:find("claw") or
                    toolName:find("human") or
                    toolName:find("fist") or
                    toolName:find("breath")
                ) then
                    if not table.find(characterTools, tool.Name) then
                        tool.Parent = Character
                        return tool.Name
                    end
                    
                elseif type == "Sword" and (
                    toolName:find("sword") or
                    toolName:find("katana") or
                    toolName:find("blade") or
                    toolName:find("saber") or
                    toolName:find("cutlass")
                ) then
                    if not table.find(characterTools, tool.Name) then
                        tool.Parent = Character
                        return tool.Name
                    end
                    
                elseif type == "Gun" and (
                    toolName:find("gun") or
                    toolName:find("pistol") or
                    toolName:find("rifle") or
                    toolName:find("bazooka") or
                    toolName:find("slingshot")
                ) then
                    if not table.find(characterTools, tool.Name) then
                        tool.Parent = Character
                        return tool.Name
                    end
                end
            end
        end
    end
    return "None"
end

function AttackCombo()
    -- Improved attack system with combo
    local attacks = {"X", "Z", "C", "V", "F"}
    
    for i = 1, 3 do
        local key = attacks[math.random(1, #attacks)]
        VirtualInputManager:SendKeyEvent(true, key, false, nil)
        task.wait(0.08)
        VirtualInputManager:SendKeyEvent(false, key, false, nil)
        task.wait(0.12)
    end
end

function FindNearestNPC(maxDistance)
    UpdatePlayerData()
    local nearest = nil
    local closestDist = maxDistance or 100
    
    if Workspace:FindFirstChild("Enemies") then
        for _, npc in pairs(Workspace.Enemies:GetChildren()) do
            if npc:FindFirstChild("Humanoid") and npc.Humanoid.Health > 0 
               and npc:FindFirstChild("HumanoidRootPart") then
               
                local dist = (HumanoidRootPart.Position - npc.HumanoidRootPart.Position).Magnitude
                if dist < closestDist then
                    closestDist = dist
                    nearest = npc
                end
            end
        end
    end
    
    return nearest, closestDist
end

-- =============================================
-- üéØ ADVANCED FARMING SYSTEM
-- =============================================
local FarmingSystem = {
    CurrentSea = 0,
    LastPosition = Vector3.new(),
    StuckCounter = 0,
    NoEnemyCounter = 0
}

function FarmingSystem:Init()
    self.CurrentSea = CheckSea()
    self.LastPosition = HumanoidRootPart.Position
end

function FarmingSystem:GetFarmSpot(level, sea)
    local spots = {
        [1] = {  -- Sea 1
            {Level = {1, 10}, CFrame = CFrame.new(-1058.93, 15.13, 1546.95), Name = "Bandit"},
            {Level = {11, 20}, CFrame = CFrame.new(-1234.46, 21.89, 1559.26), Name = "Gorilla"},
            {Level = {21, 30}, CFrame = CFrame.new(-1142.19, 15.13, 4352.36), Name = "Brute"},
            {Level = {31, 40}, CFrame = CFrame.new(-1460.93, 14.13, 4331.69), Name = "Monkey"},
            {Level = {41, 60}, CFrame = CFrame.new(-1059.59, 14.13, 4399.74), Name = "Military Soldier"},
            {Level = {61, 75}, CFrame = CFrame.new(-2314.32, 73.60, -2577.89), Name = "Military Spy"},
            {Level = {76, 90}, CFrame = CFrame.new(-5436.21, 313.79, -2931.33), Name = "Officer"},
            {Level = {91, 100}, CFrame = CFrame.new(-5815.12, 50.65, -4467.28), Name = "Shanks"},
            {Level = {101, 125}, CFrame = CFrame.new(-1024.52, 15.13, 4321.69), Name = "Gang Member"},
            {Level = {126, 150}, CFrame = CFrame.new(-1546.53, 13.13, 4304.69), Name = "Swan Pirate"},
            {Level = {151, 175}, CFrame = CFrame.new(-1245.36, 13.13, 4662.59), Name = "Factory Staff"},
            {Level = {176, 200}, CFrame = CFrame.new(292.88, 40.13, -5564.08), Name = "Marine Lieutenant"},
            {Level = {201, 225}, CFrame = CFrame.new(-1074.65, 13.13, 4086.42), Name = "Marine Captain"},
            {Level = {226, 250}, CFrame = CFrame.new(244.17, 73.65, -5256.65), Name = "Veteran"},
            {Level = {251, 275}, CFrame = CFrame.new(-1610.15, 13.13, 4832.21), Name = "Sky Bandit"},
            {Level = {276, 300}, CFrame = CFrame.new(-5017.12, 28.68, -2836.87), Name = "Dark Master"},
            {Level = {301, 325}, CFrame = CFrame.new(5207.07, 5.15, 745.43), Name = "Toga Warrior"},
            {Level = {326, 350}, CFrame = CFrame.new(4839.77, 4.32, 1663.62), Name = "Royal Soldier"},
            {Level = {351, 375}, CFrame = CFrame.new(-6035.68, 15.23, -4956.98), Name = "Shanda"},
            {Level = {376, 400}, CFrame = CFrame.new(5229.33, 12.32, -1330.92), Name = "Factory Staff (Midnight)"},
            {Level = {401, 450}, CFrame = CFrame.new(5492.79, 28.32, -688.18), Name = "Marine Lieutenant (Midnight)"},
            {Level = {451, 500}, CFrame = CFrame.new(2917.82, 12.32, 3927.08), Name = "Military Soldier (Midnight)"},
            {Level = {501, 550}, CFrame = CFrame.new(5534.92, 12.32, 100.18), Name = "Military Spy (Midnight)"},
            {Level = {551, 600}, CFrame = CFrame.new(6747.92, 12.32, 325.18), Name = "Fishman Warrior"},
            {Level = {601, 650}, CFrame = CFrame.new(6107.92, 12.32, -213.82), Name = "Fishman Commando"},
            {Level = {651, 699}, CFrame = CFrame.new(2903.92, 12.32, -3727.82), Name = "God's Guard"}
        },
        [2] = {  -- Sea 2
            {Level = {700, 724}, CFrame = CFrame.new(-64.92, 70.32, 4473.34), Name = "Desert Bandits"},
            {Level = {725, 774}, CFrame = CFrame.new(1607.87, 3.74, 1645.51), Name = "Snow Bandits"},
            {Level = {775, 799}, CFrame = CFrame.new(383.07, 45.92, -3394.12), Name = "Snowman"},
            {Level = {800, 874}, CFrame = CFrame.new(-1092.29, 44.53, 4941.13), Name = "Chief Petty Officer"},
            {Level = {875, 899}, CFrame = CFrame.new(-1611.92, 6.92, 4830.81), Name = "Sky Bandits"},
            {Level = {900, 949}, CFrame = CFrame.new(-5017.12, 28.68, -2836.87), Name = "Dark Master"},
            {Level = {950, 974}, CFrame = CFrame.new(3524.69, 7.32, -2941.18), Name = "Toga Warrior"},
            {Level = {975, 999}, CFrame = CFrame.new(4839.77, 4.32, 1663.62), Name = "Royal Soldier"},
            {Level = {1000, 1049}, CFrame = CFrame.new(-6035.68, 15.23, -4956.98), Name = "Shanda"},
            {Level = {1050, 1099}, CFrame = CFrame.new(5229.33, 12.32, -1330.92), Name = "Factory Staff"},
            {Level = {1100, 1149}, CFrame = CFrame.new(5492.79, 28.32, -688.18), Name = "Marine Lieutenant"},
            {Level = {1150, 1199}, CFrame = CFrame.new(2917.82, 12.32, 3927.08), Name = "Military Soldier"},
            {Level = {1200, 1249}, CFrame = CFrame.new(5534.92, 12.32, 100.18), Name = "Military Spy"},
            {Level = {1250, 1274}, CFrame = CFrame.new(6747.92, 12.32, 325.18), Name = "Fishman Warrior"},
            {Level = {1275, 1299}, CFrame = CFrame.new(6107.92, 12.32, -213.82), Name = "Fishman Commando"},
            {Level = {1300, 1324}, CFrame = CFrame.new(2903.92, 12.32, -3727.82), Name = "God's Guard"},
            {Level = {1325, 1349}, CFrame = CFrame.new(5230.92, 12.32, 182.18), Name = "Warden"},
            {Level = {1350, 1374}, CFrame = CFrame.new(4742.92, 12.32, -2253.82), Name = "Chief Warden"},
            {Level = {1375, 1424}, CFrame = CFrame.new(5207.92, 12.32, 4702.18), Name = "Yeti"},
            {Level = {1425, 1449}, CFrame = CFrame.new(5747.92, 12.32, 456.18), Name = "Mobs Leader"},
            {Level = {1450, 1474}, CFrame = CFrame.new(2889.92, 12.32, -3691.82), Name = "Arctic Warrior"},
            {Level = {1475, 1499}, CFrame = CFrame.new(6118.92, 12.32, -214.82), Name = "Snow Lurker"}
        },
        [3] = {  -- Sea 3
            {Level = {1500, 1524}, CFrame = CFrame.new(-380.48, 73.04, 5727.34), Name = "Pirate Millionaire"},
            {Level = {1525, 1574}, CFrame = CFrame.new(-250.86, 73.04, 6342.24), Name = "Dragon Crew Warrior"},
            {Level = {1575, 1599}, CFrame = CFrame.new(-561.54, 73.04, 6876.58), Name = "Dragon Crew Archer"},
            {Level = {1600, 1624}, CFrame = CFrame.new(861.82, 125.22, 28277.57), Name = "Female Islander"},
            {Level = {1625, 1649}, CFrame = CFrame.new(1450.42, 125.22, 28153.65), Name = "Giant Islander"},
            {Level = {1650, 1674}, CFrame = CFrame.new(1357.44, 125.22, 28473.99), Name = "Marine Commodore"},
            {Level = {1675, 1724}, CFrame = CFrame.new(1683.97, 125.22, 28389.43), Name = "Marine Rear Admiral"},
            {Level = {1725, 1774}, CFrame = CFrame.new(2908.88, 423.85, 20619.22), Name = "Fishman Raider"},
            {Level = {1775, 1799}, CFrame = CFrame.new(3178.72, 423.85, 20783.22), Name = "Fishman Captain"},
            {Level = {1800, 1824}, CFrame = CFrame.new(-10994.68, 354.04, -1026.42), Name = "Forest Pirate"},
            {Level = {1825, 1849}, CFrame = CFrame.new(-13301.74, 405.88, -9530.71), Name = "Mythological Pirate"},
            {Level = {1850, 1899}, CFrame = CFrame.new(-13486.83, 332.42, -8997.34), Name = "Jungle Pirate"},
            {Level = {1900, 1924}, CFrame = CFrame.new(-12087.62, 551.66, -10850.64), Name = "Musketeer Pirate"},
            {Level = {1925, 1974}, CFrame = CFrame.new(-9481.89, 142.14, 5563.56), Name = "Reborn Skeleton"},
            {Level = {1975, 1999}, CFrame = CFrame.new(-8763.96, 142.14, 6179.34), Name = "Living Zombie"},
            {Level = {2000, 2024}, CFrame = CFrame.new(-10112.79, 151.76, 5934.33), Name = "Demonic Soul"},
            {Level = {2025, 2074}, CFrame = CFrame.new(-9314.73, 7.00, 4471.47), Name = "Posessed Mummy"},
            {Level = {2075, 2099}, CFrame = CFrame.new(-12244.68, 491.97, -10376.14), Name = "Peanut Scout"},
            {Level = {2100, 2124}, CFrame = CFrame.new(-13612.04, 491.97, -10023.74), Name = "Peanut President"},
            {Level = {2125, 2149}, CFrame = CFrame.new(-12142.89, 491.97, -16485.91), Name = "Ice Cream Chef"},
            {Level = {2150, 2199}, CFrame = CFrame.new(-13723.59, 491.97, -15984.64), Name = "Ice Cream Commander"},
            {Level = {2200, 2224}, CFrame = CFrame.new(-13482.32, 491.97, -14482.86), Name = "Cookie Crafter"},
            {Level = {2225, 2249}, CFrame = CFrame.new(-13488.67, 491.97, -13979.13), Name = "Cake Guard"},
            {Level = {2250, 2299}, CFrame = CFrame.new(-13789.53, 491.97, -12994.86), Name = "Candy Pirate"},
            {Level = {2300, 2324}, CFrame = CFrame.new(-13294.75, 491.97, -14569.66), Name = "Chocolate Bar Battler"},
            {Level = {2325, 2374}, CFrame = CFrame.new(-12484.87, 491.97, -14236.91), Name = "Sweet Thief"},
            {Level = {2375, 2399}, CFrame = CFrame.new(-13781.85, 491.97, -14972.83), Name = "Coco Warrior"},
            {Level = {2400, 2424}, CFrame = CFrame.new(-12674.64, 491.97, -14861.14), Name = "Waffle Don"},
            {Level = {2425, 2474}, CFrame = CFrame.new(-12930.54, 491.97, -15304.86), Name = "Gummy Warrior"},
            {Level = {2475, 2499}, CFrame = CFrame.new(-12277.89, 491.97, -14432.64), Name = "Honey Raider"},
            {Level = {2500, 2549}, CFrame = CFrame.new(-11787.62, 491.97, -11562.64), Name = "Dough King Warrior"},
            {Level = {2550, 2599}, CFrame = CFrame.new(-11627.42, 491.97, -12148.94), Name = "Dough King"},
            {Level = {2600, 2649}, CFrame = CFrame.new(-12453.68, 491.97, -13660.42), Name = "Cursed Captain"},
            {Level = {2650, 2699}, CFrame = CFrame.new(-13610.74, 491.97, -13295.86), Name = "Ship Steerer"},
            {Level = {2700, 2749}, CFrame = CFrame.new(-13204.32, 491.97, -12577.64), Name = "Ship Engineer"},
            {Level = {2750, 2799}, CFrame = CFrame.new(-12782.89, 491.97, -12980.94), Name = "Ship Cleaner"}
        }
    }
    
    local seaSpots = spots[sea]
    if not seaSpots then return nil end
    
    for _, spot in pairs(seaSpots) do
        if level >= spot.Level[1] and level <= spot.Level[2] then
            return spot
        end
    end
    
    return nil
end

function FarmingSystem:CheckStuck()
    local currentPos = HumanoidRootPart.Position
    local distanceMoved = (currentPos - self.LastPosition).Magnitude
    
    if distanceMoved < 5 then
        self.StuckCounter = self.StuckCounter + 1
    else
        self.StuckCounter = 0
    end
    
    self.LastPosition = currentPos
    
    if self.StuckCounter >= 10 then
        self:Unstuck()
        return true
    end
    
    return false
end

function FarmingSystem:Unstuck()
    if Config.Misc.Notifications then
        Library:Notification("Unstucking character...", "Warning")
    end
    
    -- Jump
    VirtualInputManager:SendKeyEvent(true, "Space", false, nil)
    task.wait(0.2)
    VirtualInputManager:SendKeyEvent(false, "Space", false, nil)
    
    -- Move randomly
    local randomOffset = Vector3.new(
        math.random(-30, 30),
        10,
        math.random(-30, 30)
    )
    
    SafeTeleport(CFrame.new(HumanoidRootPart.Position + randomOffset))
    self.StuckCounter = 0
end

function FarmingSystem:SmartFarm()
    while Config.AutoFarm.Enabled do
        UpdatePlayerData()
        
        -- Check if character is alive
        if not Character or Character.Humanoid.Health <= 0 then
            if Config.Misc.Notifications then
                Library:Notification("Character died, waiting respawn...", "Warning")
            end
            task.wait(5)
            Character = Player.Character or Player.CharacterAdded:Wait()
            HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")
            Humanoid = Character:WaitForChild("Humanoid")
            continue
        end
        
        local level = GetPlayerLevel()
        local sea = CheckSea()
        
        -- Get farm spot based on level and sea
        local spot = self:GetFarmSpot(level, sea)
        
        if spot then
            -- Teleport to farm spot
            SafeTeleport(spot.CFrame)
            
            -- Anti-stuck check
            if Config.Misc.AntiStuck then
                self:CheckStuck()
            end
            
            -- Find and attack nearest NPC
            local npc, distance = FindNearestNPC(Config.AutoFarm.Distance)
            
            if npc then
                self.NoEnemyCounter = 0
                
                -- Move closer to NPC if needed
                if distance > 20 then
                    local npcCF = npc.HumanoidRootPart.CFrame
                    SafeTeleport(npcCF * CFrame.new(0, 0, 15))
                end
                
                -- Equip best tool and attack
                EquipBestTool()
                AttackCombo()
                
            else
                self.NoEnemyCounter = self.NoEnemyCounter + 1
                
                -- If no enemies for too long, move around
                if self.NoEnemyCounter >= 5 then
                    local randomCF = CFrame.new(
                        HumanoidRootPart.Position.X + math.random(-40, 40),
                        HumanoidRootPart.Position.Y,
                        HumanoidRootPart.Position.Z + math.random(-40, 40)
                    )
                    SafeTeleport(randomCF)
                    self.NoEnemyCounter = 0
                end
            end
        else
            -- Level cap reached or invalid spot
            if level >= Config.AutoFarm.LevelRange.Max then
                Config.AutoFarm.Enabled = false
                if Config.Misc.Notifications then
                    Library:Notification("üéâ Max Level Reached!", "Success")
                end
                break
            end
        end
        
        task.wait(Config.AutoFarm.TeleportDelay)
    end
end

-- =============================================
-- ‚öîÔ∏è AUTO MELEE SYSTEM
-- =============================================
local MeleeSystem = {
    MeleeData = {
        ["Dark Step"] = {
            Cost = 150000,
            Type = "Beli",
            Location = CFrame.new(-1160.17, 15.13, 3924.98),
            Requirements = {Level = 0, Sea = 1},
            NPC = "BuyBlackLeg"
        },
        ["Electric"] = {
            Cost = 500000,
            Type = "Beli",
            Location = CFrame.new(-4730.36, 716.60, -2533.04),
            Requirements = {Level = 300, MeleeMastery = {"Dark Step", 400}, Sea = 1},
            NPC = "BuyElectro"
        },
        ["Water Kung Fu"] = {
            Cost = 750000,
            Type = "Beli",
            Location = CFrame.new(61122.56, 18.47, 1568.12),
            Requirements = {Level = 0, Sea = 1},
            NPC = "BuyFishmanKarate"
        },
        ["Dragon Breath"] = {
            Cost = 1500,
            Type = "Fragments",
            Location = CFrame.new(-1034.42, 329.11, -10129.64),
            Requirements = {Level = 700, Sea = 2},
            NPC = "BuyDragonBreath"
        },
        ["Superhuman"] = {
            Cost = 3000000,
            Type = "Beli",
            Location = CFrame.new(-1160.17, 15.13, 3924.98),
            Requirements = {
                Level = 800,
                MeleeMastery = {
                    {"Dark Step", 300},
                    {"Electric", 300},
                    {"Water Kung Fu", 300},
                    {"Dragon Breath", 300}
                },
                Sea = 2
            },
            NPC = "BuySuperhuman"
        }
    }
}

function MeleeSystem:GetMeleeMastery(meleeName)
    for _, tool in pairs(Player.Backpack:GetChildren()) do
        if tool.Name == meleeName and tool:FindFirstChild("Level") then
            return tool.Level.Value
        end
    end
    return 0
end

function MeleeSystem:HasMelee(meleeName)
    for _, tool in pairs(Player.Backpack:GetChildren()) do
        if tool.Name == meleeName then
            return true
        end
    end
    return false
end

function MeleeSystem:CanBuyMelee(meleeName)
    local data = self.MeleeData[meleeName]
    if not data then return false end
    
    -- Check sea requirement
    if data.Requirements.Sea and CheckSea() < data.Requirements.Sea then
        return false, "Wrong Sea"
    end
    
    -- Check level requirement
    if data.Requirements.Level and GetPlayerLevel() < data.Requirements.Level then
        return false, "Level too low"
    end
    
    -- Check mastery requirements
    if data.Requirements.MeleeMastery then
        if type(data.Requirements.MeleeMastery[1]) == "table" then
            for _, req in pairs(data.Requirements.MeleeMastery) do
                if self:GetMeleeMastery(req[1]) < req[2] then
                    return false, req[1] .. " mastery too low"
                end
            end
        else
            local req = data.Requirements.MeleeMastery
            if self:GetMeleeMastery(req[1]) < req[2] then
                return false, req[1] .. " mastery too low"
            end
        end
    end
    
    -- Check cost
    if data.Type == "Beli" then
        if GetBeli() < data.Cost then
            return false, "Not enough Beli"
        end
    elseif data.Type == "Fragments" then
        if GetFragments() < data.Cost then
            return false, "Not enough Fragments"
        end
    end
    
    return true, "Can buy"
end

function MeleeSystem:PurchaseMelee(meleeName)
    local data = self.MeleeData[meleeName]
    if not data then return false end
    
    local canBuy, reason = self:CanBuyMelee(meleeName)
    if not canBuy then
        if Config.Misc.Notifications then
            Library:Notification("Cannot buy " .. meleeName .. ": " .. reason, "Warning")
        end
        return false
    end
    
    -- Teleport to location
    SafeTeleport(data.Location)
    task.wait(2)
    
    -- Purchase
    pcall(function()
        game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer(data.NPC)
    end)
    
    if Config.Misc.Notifications then
        Library:Notification("Purchased " .. meleeName .. "!", "Success")
    end
    
    return true
end

function MeleeSystem:AutoPurchase()
    while Config.AutoMelee.Enabled do
        UpdatePlayerData()
        
        for _, meleeName in pairs(Config.AutoMelee.PurchaseOrder) do
            if not self:HasMelee(meleeName) then
                self:PurchaseMelee(meleeName)
                task.wait(3)
            end
        end
        
        task.wait(10)
    end
end

-- =============================================
-- üìä AUTO STATS SYSTEM
-- =============================================
function AutoStatsUpgrade()
    while Config.AutoStats.Enabled do
        UpdatePlayerData()
        
        local points = GetPoints()
        
        if points > 0 then
            for _, stat in pairs(Config.AutoStats.Priority) do
                if points <= 0 then break end
                
                pcall(function()
                    game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("AddPoint", stat, 1)
                    points = points - 1
                end)
                
                task.wait(0.1)
            end
        end
        
        task.wait(5)
    end
end

-- =============================================
-- üîÑ AUTO RAID SYSTEM
-- =============================================
function AutoRaidFarm()
    while Config.AutoRaid.Enabled do
        UpdatePlayerData()
        
        if GetFragments() < Config.AutoRaid.TargetFragments then
            -- Check for raid fruits
            for _, fruit in pairs(Config.AutoRaid.SelectedFruits) do
                -- This would require a HasFruit function
                -- For now, we'll just notify
                if Config.Misc.Notifications then
                    Library:Notification("Looking for " .. fruit .. " fruit for raid...", "Info")
                end
                task.wait(2)
            end
        else
            Config.AutoRaid.Enabled = false
            if Config.Misc.Notifications then
                Library:Notification("Reached target fragments!", "Success")
            end
        end
        
        task.wait(30)
    end
end

-- =============================================
-- üé≤ AUTO FRUIT SYSTEM
-- =============================================
function AutoRandomFruit()
    while Config.AutoFruit.RandomFruit do
        if GetPlayerLevel() >= 50 then
            pcall(function()
                game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("Cousin", "Buy")
            end)
            
            if Config.Misc.Notifications then
                Library:Notification("Used random fruit", "Info")
            end
        end
        
        task.wait(7200) -- 2 hours
    end
end

-- =============================================
-- üìú AUTO CODE REDEEM
-- =============================================
function RedeemAllCodes()
    local codes = {
        "KITT_RESET", "SUB2GAMERROBOT_RESET1", "SUB2UNCLEKIZARU",
        "ADMINHACKED", "LIGHTNINGABUSE", "SUB2GAMERROBOT_EXP1",
        "KITTGAMING", "SUB2OFFICIALNOOBIE", "SUB2CAPTAINMAUI",
        "SUB2FER999", "ENYU_IS_PRO", "MAGICBUS", "STARCODEHEO",
        "BLUXXY", "THEGREATACE", "AXIORE", "STRAWHATMAINE",
        "1LOSTADMIN", "BIGNEWS", "FUDD10_V2", "FUDD10", "CHANDLER"
    }
    
    for _, code in pairs(codes) do
        pcall(function()
            game:GetService("ReplicatedStorage").Remotes.Redeem:InvokeServer(code)
        end)
        task.wait(1)
    end
    
    if Config.Misc.Notifications then
        Library:Notification("All codes redeemed!", "Success")
    end
end

-- =============================================
-- üåê SERVER HOP SYSTEM
-- =============================================
function HopServer()
    local function GetServers(placeId, sortOrder, limit)
        local url = string.format(
            "https://games.roblox.com/v1/games/%s/servers/Public?sortOrder=%s&limit=%s",
            placeId, sortOrder, limit
        )
        
        local response = HttpService:JSONDecode(game:HttpGet(url))
        return response.data
    end
    
    local servers = GetServers(game.PlaceId, "Desc", 100)
    
    for _, server in pairs(servers) do
        if server.playing < server.maxPlayers and server.id ~= game.JobId then
            TeleportService:TeleportToPlaceInstance(game.PlaceId, server.id, Player)
            break
        end
    end
end

-- =============================================
-- üéÆ USER INTERFACE
-- =============================================
local MainTab = Window:NewTab("üè¥‚Äç‚ò†Ô∏è Main")
local MainSection = MainTab:NewSection("Auto Farm")

MainSection:NewToggle("Auto Farm Level", "Smart farm level 1-2800", function(state)
    Config.AutoFarm.Enabled = state
    if state then
        FarmingSystem:Init()
        spawn(function() FarmingSystem:SmartFarm() end)
        Library:Notification("Auto Farm ON", "Success")
    else
        Library:Notification("Auto Farm OFF", "Warning")
    end
end)

MainSection:NewToggle("Auto Buy Melee", "Auto purchase all melee styles", function(state)
    Config.AutoMelee.Enabled = state
    if state then
        spawn(function() MeleeSystem:AutoPurchase() end)
        Library:Notification("Auto Melee ON", "Success")
    end
end)

MainSection:NewToggle("Auto Raid", "Auto farm fragments from raids", function(state)
    Config.AutoRaid.Enabled = state
    if state then
        spawn(function() AutoRaidFarm() end)
        Library:Notification("Auto Raid ON", "Success")
    end
end)

MainSection:NewToggle("Auto Random Fruit", "Use random fruit every 2h", function(state)
    Config.AutoFruit.RandomFruit = state
    if state then
        spawn(function() AutoRandomFruit() end)
        Library:Notification("Auto Random Fruit ON", "Success")
    end
end)

local StatsTab = Window:NewTab("üìä Stats & Skills")
local StatsSection = StatsTab:NewSection("Auto Stats")

StatsSection:NewToggle("Auto Upgrade Stats", "Auto upgrade stats with points", function(state)
    Config.AutoStats.Enabled = state
    if state then
        spawn(function() AutoStatsUpgrade() end)
        Library:Notification("Auto Stats ON", "Success")
    end
end)

StatsSection:NewDropdown("Stats Priority", "Set upgrade priority", 
    {"Melee", "Health", "Sword", "Defense", "Fruit", "Gun"}, 
    function(option)
        table.remove(Config.AutoStats.Priority, table.find(Config.AutoStats.Priority, option))
        table.insert(Config.AutoStats.Priority, 1, option)
        Library:Notification("Priority: " .. option, "Info")
    end
)

local QuestTab = Window:NewTab("üéØ Quests")
local QuestSection = QuestTab:NewSection("Auto Quest")

QuestSection:NewToggle("Auto Soul Guitar", "Auto complete Soul Guitar quest", function(state)
    Config.AutoQuest.SoulGuitar = state
    Library:Notification("Soul Guitar: " .. (state and "ON" or "OFF"), "Info")
end)

QuestSection:NewToggle("Auto CDK", "Auto complete Cursed Dual Katana quest", function(state)
    Config.AutoQuest.CDK = state
    Library:Notification("CDK: " .. (state and "ON" or "OFF"), "Info")
end)

local SettingsTab = Window:NewTab("‚öôÔ∏è Settings")
local SettingsSection = SettingsTab:NewSection("Configuration")

SettingsSection:NewToggle("Safe Teleport", "Use safe teleport method", function(state)
    Config.Misc.SafeTeleport = state
end)

SettingsSection:NewToggle("Anti-Stuck", "Auto detect and fix stuck", function(state)
    Config.Misc.AntiStuck = state
end)

SettingsSection:NewToggle("Notifications", "Show system notifications", function(state)
    Config.Misc.Notifications = state
end)

SettingsSection:NewSlider("Farm Distance", "Max distance to attack NPC", 200, 10, function(value)
    Config.AutoFarm.Distance = value
end)

local MiscTab = Window:NewTab("üõ†Ô∏è Misc")
local MiscSection = MiscTab:NewSection("Utilities")

MiscSection:NewButton("Redeem All Codes", "Redeem all available codes", function()
    RedeemAllCodes()
end)

MiscSection:NewButton("Server Hop", "Hop to another server", function()
    HopServer()
end)

MiscSection:NewToggle("Auto Redeem Codes", "Auto redeem codes on startup", function(state)
    Config.Misc.AutoRedeem = state
end)

local InfoTab = Window:NewTab("üìä Info")
local InfoSection = InfoTab:NewSection("Player Stats")

spawn(function()
    while task.wait(1) do
        pcall(function()
            UpdatePlayerData()
            InfoSection:Clear()
            InfoSection:NewLabel("Level: " .. GetPlayerLevel())
            InfoSection:NewLabel("Beli: " .. formatNumber(GetBeli()))
            InfoSection:NewLabel("Fragments: " .. formatNumber(GetFragments()))
            InfoSection:NewLabel("Stat Points: " .. GetPoints())
            InfoSection:NewLabel("Sea: " .. CheckSea())
            
            local equipped = EquipBestTool()
            InfoSection:NewLabel("Equipped: " .. equipped)
        end)
    end
end)

-- Helper function
function formatNumber(num)
    if num >= 1000000 then
        return string.format("%.1fM", num / 1000000)
    elseif num >= 1000 then
        return string.format("%.1fK", num / 1000)
    else
        return tostring(num)
    end
end

-- =============================================
-- üöÄ INITIALIZATION
-- =============================================
FarmingSystem:Init()

-- Start essential systems
spawn(function()
    task.wait(3)
    if Config.Misc.AutoRedeem then
        RedeemAllCodes()
    end
    
    spawn(function() AutoStatsUpgrade() end)
    
    if Config.Misc.Notifications then
        Library:Notification("üî• Haiiz Kaitun Ultimate v6.0 Loaded!", "Welcome")
        Library:Notification("Complete Auto System Activated", "Info")
    end
    
    print([[
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë        HAIIZ KAITUN ULTIMATE v6.0           ‚ïë
‚ïë        Complete Auto Farm System            ‚ïë
‚ïë        Rebuilt from Scratch                 ‚ïë
‚ïë        For Educational Purposes             ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
    ]])
end)

-- Auto data update
spawn(function()
    while task.wait(1) do
        UpdatePlayerData()
    end
end)

-- Anti-stuck monitor
if Config.Misc.AntiStuck then
    spawn(function()
        while task.wait(1) do
            if Config.AutoFarm.Enabled then
                FarmingSystem:CheckStuck()
            end
        end
    end)
end